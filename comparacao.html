<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Compara√ß√£o</title>

<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="js/supabase.js"></script>

<style>
  body {
    margin:0;
    background:#000; /* fundo escuro padr√£o */
    height:100vh;
    overflow:auto;
    color:#fff;
  }

  .compare-container {
    max-width:900px;
    margin:0 auto;
    padding:20px;
  }

  /* =====================================================
     GRID DAS IMAGENS
  ====================================================== */
  #grid {
    display:grid;
    gap:20px;
  }

  #grid.lado {
    grid-template-columns:1fr 1fr;
  }

  #grid.baixo {
    grid-template-columns:1fr;
  }

  .img-wrap {
    background:#000;
    border-radius:12px;
    overflow:hidden;
    position:relative;
    touch-action:pinch-zoom;
  }

  .compare-img {
    width:100%;
    object-fit:contain;
    transition:transform 0.15s ease-out;
  }

  /* =====================================================
     PAINEL DE BOT√ïES LATERAL
  ====================================================== */
  .sidebar {
    position:fixed;
    top:50%;
    right:10px;
    transform:translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index:1000;
  }

  .btn-side {
    background:#1c1c1e;
    color:#fff;
    border:none;
    padding:10px 12px;
    border-radius:10px;
    font-size:14px;
    cursor:pointer;
    min-width:60px;
  }

  /* bot√£o maior para voltar */
  .btn-back {
    background:#007aff;
    font-weight:700;
  }

  /* no celular, reduz largura para caber melhor */
  @media(max-width:600px) {
    .sidebar {
      right:6px;
    }
    .btn-side {
      padding:8px 10px;
      font-size:12px;
    }
  }
</style>
</head>
<body>

<div class="sidebar">
  <button class="btn-side" onclick="zoomIn(1)">üîç‚ûï</button>
  <button class="btn-side" onclick="zoomOut(1)">üîç‚ûñ</button>

  <button class="btn-side" onclick="zoomIn(2)">üîç‚ûï</button>
  <button class="btn-side" onclick="zoomOut(2)">üîç‚ûñ</button>

  <button class="btn-side" onclick="trocarPosicao()">‚áÜ</button>
  <button class="btn-side" onclick="toggleModo()">‚Üï/‚Üî</button>

  <button class="btn-side btn-back" onclick="window.location='galeria.html'">‚Üê</button>
</div>

<div class="compare-container">

  <div id="grid" class="lado"> 
    <div class="img-wrap"><img id="img1" class="compare-img"></div>
    <div class="img-wrap"><img id="img2" class="compare-img"></div>
  </div>

</div>

<script>
/* =====================================================
   CARREGAR IMAGENS
====================================================== */
async function carregarComparacao() {
  const id1 = localStorage.getItem("comparar_id1");
  const id2 = localStorage.getItem("comparar_id2");

  if (!id1 || !id2) {
    alert("Selecione 2 fotos na galeria.");
    window.location = "galeria.html";
    return;
  }

  const { data } = await supabase
    .from("fotos")
    .select("id, url")
    .in("id", [id1, id2]);

  if (!data || data.length < 2) {
    alert("Erro ao carregar imagens.");
    window.location = "galeria.html";
    return;
  }

  const img1 = data.find(f => f.id == id1);
  const img2 = data.find(f => f.id == id2);

  document.getElementById("img1").src = img1.url + "?v=" + Date.now();
  document.getElementById("img2").src = img2.url + "?v=" + Date.now();
}

carregarComparacao();

/* =====================================================
   ZOOM INDEPENDENTE
====================================================== */

let scale1 = 1, scale2 = 1;

function aplicarZoom() {
  document.getElementById("img1").style.transform = `scale(${scale1})`;
  document.getElementById("img2").style.transform = `scale(${scale2})`;
}

function zoomIn(num) {
  if (num === 1) scale1 = Math.min(scale1 + 0.2, 4);
  if (num === 2) scale2 = Math.min(scale2 + 0.2, 4);
  aplicarZoom();
}

function zoomOut(num) {
  if (num === 1) scale1 = Math.max(scale1 - 0.2, 1);
  if (num === 2) scale2 = Math.max(scale2 - 0.2, 1);
  aplicarZoom();
}

/* =====================================================
   TROCAR POSI√á√ÉO
====================================================== */
function trocarPosicao() {
  const grid = document.getElementById("grid");
  const wrap1 = document.getElementById("img1").parentElement;
  const wrap2 = document.getElementById("img2").parentElement;
  grid.insertBefore(wrap2, wrap1);
}

/* =====================================================
   MODO LADO A LADO / EM CIMA
====================================================== */
let modo = "lado";

function toggleModo() {
  const grid = document.getElementById("grid");

  modo = (modo === "lado") ? "baixo" : "lado";

  if (modo === "lado") {
    grid.classList.remove("baixo");
    grid.classList.add("lado");
    document.body.style.height = "100vh";  
    document.body.style.overflow = "auto";
  } else {
    grid.classList.remove("lado");
    grid.classList.add("baixo");
    document.body.style.height = "auto";  
  }
}
</script>

</body>
</html>
