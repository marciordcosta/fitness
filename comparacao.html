<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Compara√ß√£o</title>

<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="js/supabase.js"></script>

<style>
  body {
    margin:0;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
    color:#fff;
  }

  .compare-box {
    width:95%;
    max-width:820px;
    background:#111;
    padding:18px;
    border-radius:16px;
    box-shadow:0 8px 22px rgba(0,0,0,0.45);
    animation:fadeUp .25s ease-out;
  }

 .img-wrap {
    overflow: hidden;
    position: relative;
  }
 .compare-img {
   will-change: transform;
   transition: transform 0.15s ease-out;
  }

  @keyframes fadeUp {
    from {opacity:0; transform:translateY(12px);}
    to {opacity:1; transform:translateY(0);}
  }

  .toolbar {
    display:flex;
    justify-content:space-between;
    margin-bottom:14px;
    gap:10px;
  }

  .btn-tool {
    padding:10px 12px;
    border:none;
    border-radius:10px;
    background:#1c1c1e;
    color:#fff;
    font-size:14px;
    cursor:pointer;
    flex:1;
  }

  .compare-grid {
    display:grid;
    gap:12px;
  }

  .compare-grid.lado {
    grid-template-columns:1fr 1fr;
  }

  .compare-grid.baixo {
    grid-template-columns:1fr;
  }

  .img-wrap {
    background:#000;
    border-radius:12px;
    overflow:hidden;
    position:relative;
    touch-action:pinch-zoom;
  }

  .compare-img {
    width:100%;
    border-radius:12px;
    object-fit:contain;
    transition:transform .2s ease-out;
  }

  .btn-voltar {
    margin-top:14px;
    width:100%;
    padding:12px;
    background:#007aff;
    border:none;
    border-radius:12px;
    font-size:16px;
    color:#fff;
    cursor:pointer;
  }

 .toolbar {
  position: relative;
  z-index: 10;
 }

.compare-box {
  position: relative;
  overflow: hidden;
}
  
</style>

</head>
<body>

<div class="compare-box">

  <!-- üß∞ Barra de ferramentas -->
  <div class="toolbar">
    <button class="btn-tool" onclick="toggleZoom()">üîç Zoom</button>
    <button class="btn-tool" onclick="trocarPosicao()">‚áÜ Inverter</button>
    <button class="btn-tool" onclick="toggleFundo()">‚¨õ Fundo</button>
    <button class="btn-tool" onclick="toggleModo()">‚Üï/‚Üî Modo</button>
  </div>

  <!-- IMAGENS -->
  <div id="grid" class="compare-grid lado">
    <div class="img-wrap"><img id="img1" class="compare-img"></div>
    <div class="img-wrap"><img id="img2" class="compare-img"></div>
  </div>

  <button class="btn-voltar" onclick="window.location='galeria.html'">Voltar</button>

</div>

<script>
let zoomAtivo = false;
let fundoPreto = true;
let modo = "lado"; // lado | baixo

/* ===================== CARREGAR IMAGENS ===================== */
async function carregarComparacao() {
  const id1 = localStorage.getItem("comparar_id1");
  const id2 = localStorage.getItem("comparar_id2");

  if (!id1 || !id2) {
    alert("Selecione 2 fotos na galeria.");
    window.location="galeria.html";
    return;
  }

  const { data } = await supabase
    .from("fotos")
    .select("id, url")
    .in("id", [id1, id2]);

  const img1 = data.find(f => f.id == id1);
  const img2 = data.find(f => f.id == id2);

  document.getElementById("img1").src = img1.url + "?v=" + Date.now();
  document.getElementById("img2").src = img2.url + "?v=" + Date.now();
}

carregarComparacao();

/* ============================================================
   ZOOM SINCRONIZADO + ARRASTAR
=============================================================== */

let scale = 1;
let posX = 0, posY = 0;
let isDragging = false;
let lastX = 0, lastY = 0;

function aplicarTransform() {
  const imgs = document.querySelectorAll(".compare-img");
  imgs.forEach(img => {
    img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
    img.style.transformOrigin = "center center";
  });
}

function toggleZoom() {
  zoomAtivo = !zoomAtivo;

  if (!zoomAtivo) {
    scale = 1;
    posX = 0;
    posY = 0;
    aplicarTransform();
    return;
  }

  // Ativa zoom sincronizado
  scale = 1.7;
  aplicarTransform();
}

/* Mouse Zoom (scroll) */
document.addEventListener("wheel", e => {
  if (!zoomAtivo) return;

  scale += e.deltaY > 0 ? -0.1 : 0.1;
  scale = Math.max(1, Math.min(4, scale));
  aplicarTransform();
});

/* Mouse arrastar */
document.addEventListener("mousedown", e => {
  if (!zoomAtivo) return;
  isDragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});

document.addEventListener("mouseup", () => {
  isDragging = false;
});

document.addEventListener("mousemove", e => {
  if (!zoomAtivo || !isDragging) return;

  posX += e.clientX - lastX;
  posY += e.clientY - lastY;

  lastX = e.clientX;
  lastY = e.clientY;

  aplicarTransform();
});

/* Gestos de pin√ßa (touch) */
let touchDist = 0;

document.addEventListener("touchmove", e => {
  if (!zoomAtivo || e.touches.length !== 2) return;

  const t1 = e.touches[0];
  const t2 = e.touches[1];
  const dist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);

  if (!touchDist) touchDist = dist;

  const delta = dist - touchDist;
  touchDist = dist;

  scale += delta * 0.005;
  scale = Math.max(1, Math.min(4, scale));

  aplicarTransform();
});

document.addEventListener("touchend", () => {
  touchDist = 0;
});
/* ===================== INVERTER POSI√á√ÉO ===================== */
function trocarPosicao() {
  const grid = document.getElementById("grid");
  const wrap1 = document.getElementById("img1").parentElement;
  const wrap2 = document.getElementById("img2").parentElement;
  grid.insertBefore(wrap2, wrap1);
}

/* ===================== FUNDO PRETO / CINZA ===================== */
function toggleFundo() {
  fundoPreto = !fundoPreto;
  document.body.style.background = fundoPreto ? "#000" : "#444";
  document.querySelector(".compare-box").style.background = fundoPreto ? "#111" : "#ddd";
}

/* ===================== MODO LADO / EMBAIXO ===================== */
function toggleModo() {
  const grid = document.getElementById("grid");

  modo = modo === "lado" ? "baixo" : "lado";

  if (modo === "lado") {
    grid.classList.remove("baixo");
    grid.classList.add("lado");
  } else {
    grid.classList.remove("lado");
    grid.classList.add("baixo");
  }
}
</script>

</body>
</html>
